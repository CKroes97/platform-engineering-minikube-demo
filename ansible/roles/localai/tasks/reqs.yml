- name: Ensure LocalAI service user exists
  ansible.builtin.user:
    name: "{{ localai_user }}"
    shell: /sbin/nologin
    system: true
    create_home: true
    state: absent

- name: Install required build tools
  ansible.builtin.dnf:
    name:
      - git
      - cmake
      - ninja-build
      - gcc-13
      - g++-13
      - make
      - libcurl-devel
      - python3-devel
      - openssl-devel
      - zlib-devel
      - nodejs
      - npm
    state: present

- name: Create virtual environment directory
  ansible.builtin.file:
    path: "/home/localai/.venv"
    state: directory
    mode: '0755'

- name: Create Python virtual environment (if not exists)
  ansible.builtin.command:
    cmd: "python -m venv /home/localai/.venv"
    creates: "/home/localai/.venv/bin/activate"

- name: Install AI Python dependencies
  ansible.builtin.pip:
    name:
      - torch
      - torchvision
      - torchaudio
      - transformers
      - accelerate
    virtualenv: "/home/localai/.venv"
